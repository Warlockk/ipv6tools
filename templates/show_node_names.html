{% extends "layout.html" %}


{% block body %}
<h2 class="page-header">{{ entries|length }} devices found</h2>
<div class="row">
  <div class="col-md-6">
    <div id="nodegraph">

    </div>
  </div>
  <div class="col-md-6">
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>IP Address</th>
            <th>MAC Address</th>
            <th>Device Name</th>
          </tr>
        </thead>
        <tbody>
        {% for entry in entries %}
          <tr>
            {% if "dns_data" in entry %}
              <td><a href="#entry-details-{{loop.index0}}" data-toggle="collapse">{{ entry.ip }}</a></td>
            {% else %}
              <td>{{ entry.ip }}</td>
            {% endif %}
            <td>{{ entry.mac }}</td>
            <td>{{ entry.device_name }}</td>
            <td>{{ entry.dns_data }}</td>
          </tr>
          <tr id="entry-details-{{loop.index0}}" class="collapse card-row">
            <td colspan="5">
              <div class="card-view">
                <span class="title">IP Address</span>
                <span class="value">{{ entry.ip }}</span>
              </div>
              <div class="card-view">
                <span class="title">MAC Address</span>
                <span class="value">{{ entry.mac }}</span>
              </div>
              <div class="card-view">
                <span class="title">Device Name</span>
                <span class="value">{{ entry.device_name }}</span>
              </div>
              <div class="card-view">
                <span class="title">DNS Data</span>
                <span class="value">{{ entry.dns_data }}</span>
              </div>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
<script>
  $(function(){
    var entries = {{entries|safe}};
    for(var i in entries){
      var x = parseInt(i);
      nodegraph.graph.nodes.push({
        "id": entries[i].ip,
        "value": 1,
        "x": nodegraph.width/3,
        "y": nodegraph.height/3,
        "index": x+1,
        "name": entries[i].device_name || null,
        "dns": $.isEmptyObject(entries[i].dns_data) ? null : entries[i].dns_data
      });
      nodegraph.graph.links.push({
        "source": 0,
        "target": x+1});
    }

    nodegraph.init();
  });
</script>
{% endblock %}
