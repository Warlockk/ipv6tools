{% extends "layout.html" %}


{% block body %}
<h2 class="page-header">{{ entries|length }} devices found</h2>
<div class="row">
  <div class="col-md-6">
    <div id="nodegraph">

    </div>
  </div>
  <div class="col-md-6">
    <div>
      <table class="table table-hover" id="nodetable">
        <thead>
          <tr>
            <th>DNS</th>
            <th>IP Address</th>
            <th>MAC Address</th>
            <th>Device Name</th>
          </tr>
        </thead>
      </table>
    </div>
  </div>
</div>
<script>
  $(function(){
    var entries = {{entries|tojson|safe}};
    for(var i in entries){

      // set entries.device_name to dns response type 28 if exists
      entries[i].device_name = (function(d){
          // set the node name. if it has the device name, use that. if it has a dns response of 28, use that. otherwise null
          if(d.device_name){
            return d.device_name;
          } else if(!$.isEmptyObject(d.dns_data)) {
            var tmp = d.dns_data.filter(function(r){ return r.answer_type == 28; });
            return (tmp.length > 0) ? tmp[0].answer_name.replace('.local.', '') : null;
          } else {
            return null;
          }
        })(entries[i]);

      var x = parseInt(i);
      nodegraph.graph.nodes.push({
        "id": entries[i].ip,
        "value": 1,
        "x": nodegraph.width/3,
        "y": nodegraph.height/3,
        "index": x+1,
        "name": entries[i].device_name || '',
        "dns": $.isEmptyObject(entries[i].dns_data) ? null : entries[i].dns_data
      });
      nodegraph.graph.links.push({
        "source": 0,
        "target": x+1});
    }
    nodetable.init(entries);
    nodegraph.init();
  });
</script>
{% endblock %}
